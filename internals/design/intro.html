
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Design Principles</title>
    
    <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
    <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >let toggleHintShow = 'Click to show';</script>
    <script >let toggleHintHide = 'Click to hide';</script>
    <script >let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://cloud-katana.com/internals/design/intro.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Azure" href="../../notebooks/azure/intro.html" />
    <link rel="prev" title="Demos" href="../../deploy/local/demos.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/Logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../prepare.html">
   Prepare
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../deploy/azure/intro.html">
   Deploy to Azure
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../deploy/azure/arm.html">
     Azure Resource Manager Template
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../deploy/azure/demos.html">
     Demos
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../deploy/local/intro.html">
   Deploy Locally
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../deploy/local/demos.html">
     Demos
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Internals
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Design Principles
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Targeted Notebooks
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../notebooks/azure/intro.html">
   Azure
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../notebooks/azure/collection/intro.html">
     collection
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/collection/Get-CKMailboxMessages.html">
       Get-CKMailboxMessages
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/collection/Get-CKMyMailboxMessages.html">
       Get-CKMyMailboxMessages
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../notebooks/azure/discovery/intro.html">
     discovery
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/discovery/Get-CKAzADGroups.html">
       Get-CKAzADGroups
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/discovery/Get-CKAzADApplication.html">
       Get-CKAzADApplication
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/discovery/Get-CKAzADDirectoryRoles.html">
       Get-CKAzADDirectoryRoles
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/discovery/Get-CKAzADServicePrincipal.html">
       Get-CKAzADServicePrincipal
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/discovery/Get-CKAzADUsers.html">
       Get-CKAzADUsers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/discovery/Get-CKMembers.html">
       Get-CKMembers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/discovery/Get-CKOauth2PermissionGrants.html">
       Get-CKOauth2PermissionGrants
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/discovery/Get-CKOwners.html">
       Get-CKOwners
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/discovery/Invoke-CKAttackGraph.html">
       Invoke-CKAttackGraph
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../notebooks/azure/persistence/intro.html">
     persistence
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/persistence/Add-CKAzADAppPassword.html">
       Add-CKAzADAppPassword
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/persistence/Add-CKAzADMemberToDirectoryRole.html">
       Add-CKAzADMemberToDirectoryRole
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/persistence/Add-CKAzADSPPassword.html">
       Add-CKAzADSPPassword
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/persistence/Add-CKDomainToTenant.html">
       Add-CKDomainToTenant
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/persistence/Add-CKMemberToGroup.html">
       Add-CKMemberToGroup
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/persistence/Add-CKOwnerToAzADApp.html">
       Add-CKOwnerToAzADApp
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/persistence/Add-CKOwnerToAzADSP.html">
       Add-CKOwnerToAzADSP
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/persistence/Grant-CKPermissions.html">
       Grant-CKPermissions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/persistence/New-CKAzADApplication.html">
       New-CKAzADApplication
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/persistence/New-CKAzADServicePrincipal.html">
       New-CKAzADServicePrincipal
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../notebooks/azure/persistence/Update-CKAzADAppReqRscAccess.html">
       Update-CKAzADAppReqRscAccess
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/internals/design/intro.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/Azure/Cloud-Katana"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/Azure/Cloud-Katana/issues/new?title=Issue%20on%20page%20%2Finternals/design/intro.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/Azure/Cloud-Katana/edit/main/docs/internals/design/intro.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-serverless-execution-model">
   A “serverless” execution model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compute-on-demand-as-a-web-api">
   Compute on-demand as a Web API
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#yaml-based-attack-definitions">
   YAML based attack definitions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#orchestrated-stateful-execution">
   Orchestrated stateful execution
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#secure-authentication-and-authorization">
   Secure Authentication and Authorization
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#authentication">
     Authentication
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#authorization">
     Authorization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#managed-identities-integration">
   Managed Identities Integration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#granular-access-control-to-azure-resources">
   Granular access control to Azure Resources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#programming-language-agnostic-clients">
   Programming language agnostic clients
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cloud-and-on-prem-simulations">
   Cloud and on-prem simulations
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Design Principles</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-serverless-execution-model">
   A “serverless” execution model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compute-on-demand-as-a-web-api">
   Compute on-demand as a Web API
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#yaml-based-attack-definitions">
   YAML based attack definitions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#orchestrated-stateful-execution">
   Orchestrated stateful execution
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#secure-authentication-and-authorization">
   Secure Authentication and Authorization
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#authentication">
     Authentication
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#authorization">
     Authorization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#managed-identities-integration">
   Managed Identities Integration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#granular-access-control-to-azure-resources">
   Granular access control to Azure Resources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#programming-language-agnostic-clients">
   Programming language agnostic clients
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cloud-and-on-prem-simulations">
   Cloud and on-prem simulations
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="design-principles">
<h1>Design Principles<a class="headerlink" href="#design-principles" title="Permalink to this headline">¶</a></h1>
<p><img alt="" src="../../_images/KatanaDesign.png" /></p>
<ul class="simple">
<li><p>A serverless execution model</p></li>
<li><p>Compute on-demand as a web API</p></li>
<li><p>YAML based format to document attacker actions</p></li>
<li><p>Orchestrated stateful execution</p></li>
<li><p>Secure authentication and authorization</p></li>
<li><p>Managed identity integration</p></li>
<li><p>Granular access control</p></li>
<li><p>Programming language agnostic clients</p></li>
<li><p>Cloud and on-prem coverage</p></li>
</ul>
<div class="section" id="a-serverless-execution-model">
<h2>A “serverless” execution model<a class="headerlink" href="#a-serverless-execution-model" title="Permalink to this headline">¶</a></h2>
<p>Cloud Katana is a cloud-native solution that relies on platform as a service (PaaS) concepts to provide a simplified and scalable event-driven solution without worrying about deploying and maintaining the underlying infrastructure used to execute simulations.</p>
<p>To meet this need, Cloud Katana uses <a class="reference external" href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview">Azure Functions</a> to abstract the operating system layer from the code through a pay-per-execution billing model that automatically scales based on trigger invocations.</p>
<p><img alt="" src="../../_images/ServerlessExecutionModel.png" /></p>
</div>
<div class="section" id="compute-on-demand-as-a-web-api">
<h2>Compute on-demand as a Web API<a class="headerlink" href="#compute-on-demand-as-a-web-api" title="Permalink to this headline">¶</a></h2>
<p>Simulation steps are represented as blocks of code called “functions” and invoked via HTTP requests through a built-in serverless web API.</p>
<p>With this feature one could simply send an HTTP request with information about the specific simulation and wait for the infrastructure underneath to process the request. Currently, all functions are written in PowerShell (subject to change) and categorized following the MITRE ATT&amp;CK framework.</p>
<p><img alt="" src="../../_images/ComputeOnDemandWebAPI.png" /></p>
</div>
<div class="section" id="yaml-based-attack-definitions">
<h2>YAML based attack definitions<a class="headerlink" href="#yaml-based-attack-definitions" title="Permalink to this headline">¶</a></h2>
<p>Every attack simulation is documented in a YAML based format to aggregate metadata such as title, description, ATT&amp;CK mappings, expected input and output and even preconditions to make sure we have the right permissions before running a simulation step. This facilitates the processing of every documented action programmatically and the automatic setup of a few other resources.</p>
<p><img alt="" src="../../_images/YAMLBasedAttackDefinitions.png" /></p>
</div>
<div class="section" id="orchestrated-stateful-execution">
<h2>Orchestrated stateful execution<a class="headerlink" href="#orchestrated-stateful-execution" title="Permalink to this headline">¶</a></h2>
<p>The project is also designed to handle state and ensure reliability across numerous attack simulations by using an extension of Azure functions named <a class="reference external" href="https://docs.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-overview?tabs=powershell">durable functions</a>. This feature allows the orchestration and execution of scenarios where actions could depend on the state and output of other simulation steps. This is good to define specific attack paths as code.</p>
<p><img alt="" src="../../_images/OrchestratedStatefulExecution.png" /></p>
</div>
<div class="section" id="secure-authentication-and-authorization">
<h2>Secure Authentication and Authorization<a class="headerlink" href="#secure-authentication-and-authorization" title="Permalink to this headline">¶</a></h2>
<p>Cloud Katana also enforces authentication and authorization best practices to secure the application.</p>
<div class="section" id="authentication">
<h3>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h3>
<p>The project uses the <a class="reference external" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-overview">Microsoft Identity Platform</a> (a.k.a Azure AD) as its identity provider to authenticate clients. This feature requires a registered Azure AD application which allows users to connect to the Azure Function app using OAuth authentication.</p>
<p>In addition, using an identity provider enables the following features:</p>
<ul class="simple">
<li><p>Conditional access policies</p></li>
<li><p>The use of <a class="reference external" href="https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-mfa-howitworks">multi-factor authentication</a></p></li>
<li><p>Single sign-on (SSO)</p></li>
</ul>
<p><img alt="" src="../../_images/DeviceAuthGrantFlow.png" /></p>
</div>
<div class="section" id="authorization">
<h3>Authorization<a class="headerlink" href="#authorization" title="Permalink to this headline">¶</a></h3>
<p>Besides enforcing users to authenticate before executing simulations, the project also implements “Application Role Assignments” to restrict access to selected users. This allows organizations to select who can use the project in their environments.</p>
</div>
</div>
<div class="section" id="managed-identities-integration">
<h2>Managed Identities Integration<a class="headerlink" href="#managed-identities-integration" title="Permalink to this headline">¶</a></h2>
<p>Furthermore, when executing simulations in Azure, Cloud Katana uses a user-assigned managed identity to access and interact with other Azure AD-protected resources. One of the advantages of managed identities is that it removes the need to provision or rotate any secrets.</p>
<p><img alt="" src="../../_images/UserAssignedManagedIdentity.png" /></p>
</div>
<div class="section" id="granular-access-control-to-azure-resources">
<h2>Granular access control to Azure Resources<a class="headerlink" href="#granular-access-control-to-azure-resources" title="Permalink to this headline">¶</a></h2>
<p>In addition, access to Azure resources is defined by the permissions assigned to the managed identity. We currently cover Azure based scenarios. Therefore, we use permissions associated with <a class="reference external" href="https://docs.microsoft.com/en-us/graph/permissions-reference">each major set of Microsoft Graph APIs</a> to control access to specific Azure resources.</p>
<p>For example, if we wanted to use Cloud Katana to add credentials to an application, we would need to grant the <a class="reference external" href="https://docs.microsoft.com/en-us/graph/api/application-addpassword?view=graph-rest-1.0&amp;tabs=http#permissions">following permissions</a> (From least to most privileged) to the managed identity:</p>
<ul class="simple">
<li><p>Application.ReadWrite.OwnedBy</p></li>
<li><p>Application.Read.Write.All</p></li>
</ul>
<p><img alt="" src="../../_images/GranularAccessControl.png" /></p>
</div>
<div class="section" id="programming-language-agnostic-clients">
<h2>Programming language agnostic clients<a class="headerlink" href="#programming-language-agnostic-clients" title="Permalink to this headline">¶</a></h2>
<p>Another feature that makes Cloud Katana a very powerful tool is the flexibility to use any programming language to request simulations. If the client used to interact with Cloud Katana can handle the Azure AD authentication process, it does not matter how the simulation is requested.</p>
<p><img alt="" src="../../_images/ProgrammingLanguageAgnosticClient.png" /></p>
<p>Microsoft Authentication libraries are available via PowerShell as <a class="reference external" href="https://github.com/AzureAD/MSAL.PS">MSAL.PS</a> and Python as <a class="reference external" href="https://pypi.org/project/msal/">MSAL</a> . We could also use other open-source projects such as <a class="reference external" href="https://jupyter.org/">Jupyter Notebooks</a> to create repetitive templates to show the execution of simulations and share the process with other security researchers.</p>
<p><img alt="" src="../../_images/JupyterNotebookSimulations.png" /></p>
</div>
<div class="section" id="cloud-and-on-prem-simulations">
<h2>Cloud and on-prem simulations<a class="headerlink" href="#cloud-and-on-prem-simulations" title="Permalink to this headline">¶</a></h2>
<p>Finally, we are currently experimenting with <a class="reference external" href="https://docs.microsoft.com/en-us/azure/app-service/app-service-hybrid-connections">Azure App Service Hybrid Connections</a> to not only run simulations in the cloud, but also on-premises. Hybrid Connections use a <a class="reference external" href="https://docs.microsoft.com/en-us/azure/azure-relay/relay-what-is-it">relay agent</a> to securely expose services that run on-premises to the public cloud.  The relay agent sits in the middle between the on-prem server and the Cloud Katana Azure Function app.</p>
<p>A relay agent ( <a class="reference external" href="https://docs.microsoft.com/en-us/azure/app-service/app-service-hybrid-connections#hybrid-connection-manager">Hybrid Connection Manager (HCM)</a> ) is set up on the on-prem server and configured to call out to the Azure Relay over port 443. The Cloud Katana function app then connects to the Azure Relay to interact with the on-prem server and execute simulations locally. The connection uses TLS 1.2 for security and shared access signature (SAS) keys for authentication and authorization.</p>
<p><img alt="" src="../../_images/OnPremSimulations.png" /></p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "Azure/Cloud-Katana",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./internals\design"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../../deploy/local/demos.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Demos</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../../notebooks/azure/intro.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Azure</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Microsoft Corporation<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
    <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  
  </body>
</html>