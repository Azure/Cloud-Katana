Search.setIndex({"docnames": ["deploy/azure/arm", "deploy/azure/intro", "intro", "learn/principles/intro", "learn/schema", "learn/simulation", "simulate/azure/attackscenario-7d918ee0-6928-48c5-8cf9-5dfb88abc7c4", "simulate/azure/attackscenario-7dde2208-d4eb-480e-afa1-bad0ab7e861b", "simulate/azure/attackscenario-81b67a16-5218-41e6-8c6d-1fc6a10b757a", "simulate/azure/intro"], "filenames": ["deploy\\azure\\arm.md", "deploy\\azure\\intro.md", "intro.md", "learn\\principles\\intro.md", "learn\\schema.md", "learn\\simulation.md", "simulate\\azure\\attackscenario-7d918ee0-6928-48c5-8cf9-5dfb88abc7c4.md", "simulate\\azure\\attackscenario-7dde2208-d4eb-480e-afa1-bad0ab7e861b.md", "simulate\\azure\\attackscenario-81b67a16-5218-41e6-8c6d-1fc6a10b757a.md", "simulate\\azure\\intro.md"], "titles": ["Azure Resource Manager Template", "Deploy to Azure", "Cloud Katana", "Design Principles", "Attack Scenario Schema", "Request Simulations", "Azure AD Light Discovery", "Admin promotion via Directory Role Permission Grant", "Add New Password Credential to Azure AD Application and Read Mail", "Azure"], "terms": {"us": [0, 2, 3, 4, 5, 7, 9], "command": 0, "az": 0, "login": [0, 5, 6, 7, 8], "ad": [0, 3, 4, 5, 7, 9], "an": [0, 1, 2, 3, 4, 5, 7, 8, 9], "account": [0, 4, 7, 9], "tenant": [0, 5], "xxxxxxxx": 0, "xxxx": 0, "xxxxxxxxxxxx": 0, "git": 0, "http": [0, 1, 3, 4, 5], "github": [0, 1, 2, 5], "com": [0, 4, 5, 6, 7, 8], "thi": [0, 1, 2, 3, 4], "base": 0, "abil": 0, "avail": [0, 3, 5], "cloudkatanatool": [0, 5], "psm1": [0, 5], "verbos": 0, "we": [0, 2, 3, 5], "ar": [0, 3, 4], "go": [0, 4], "few": [0, 2, 3], "whole": 0, "setup": [0, 3], "aadpowershellappid": 0, "1b730954": 0, "1685": 0, "4b74": 0, "9bfd": 0, "dac224a7b894": 0, "azmanagementurl": 0, "msgraphurl": 0, "subscriptionid": 0, "subscript": 0, "id": [0, 4, 5, 6, 7, 8], "resourcegroupnam": 0, "name": [0, 3, 4, 5, 6, 7, 8], "If": [0, 3, 4], "doesn": 0, "t": 0, "exist": 0, "functionappnam": [0, 5], "join": [0, 2], "cloudkatana": [0, 4, 5, 6, 7, 8], "65": 0, "90": 0, "97": 0, "122": 0, "random": 0, "count": 0, "10": 0, "char": 0, "_": 0, "tolow": 0, "need": [0, 2, 3], "activ": 0, "directori": [0, 5, 6, 9], "applic": [0, 2, 3, 4, 5, 6, 7, 9], "app": [0, 3, 5, 6, 7, 8], "To": [0, 3], "sign": [0, 3, 4], "web": 0, "browser": 0, "open": [0, 2, 3], "page": 0, "devicelogin": 0, "enter": 0, "azmgmtdcrequest": 0, "ckdevicecod": 0, "clientid": [0, 7, 8], "user_cod": 0, "device_cod": 0, "verification_url": 0, "expires_in": 0, "900": 0, "interv": 0, "5": [0, 5, 6, 7], "messag": 0, "azmgmttoken": 0, "ckaccesstoken": [0, 7, 8], "granttyp": [0, 7, 8], "devicecod": 0, "azmgmtaccesstoken": 0, "access_token": [0, 6, 7, 8], "all": [0, 1, 3, 4, 5], "resourcegroup": 0, "new": [0, 7, 9], "ckazresourcegroup": 0, "locat": [0, 4], "eastu": 0, "accesstoken": [0, 4, 7, 8], "besid": [0, 3], "function": [0, 2, 3, 4], "orchestr": 0, "attack": 0, "simul": [0, 2, 4, 6, 7, 8, 9], "leverag": 0, "follow": [0, 3, 4, 5], "addit": [0, 3, 4], "capabl": 0, "server": [0, 2, 3], "enabl": [0, 3, 5], "author": [0, 5, 6, 7, 8, 9], "featur": [0, 3], "via": [0, 1, 2, 3, 5, 8, 9], "client": [0, 5], "A": [0, 4, 6, 7, 8, 9], "nativ": [0, 2, 3], "interact": [0, 3], "s": [0, 5], "serverless": [0, 2], "part": 0, "process": [0, 1, 2, 3], "facilit": [0, 3], "granular": 0, "control": [0, 2], "other": [0, 2, 3], "protect": [0, 3], "requir": [0, 3, 4], "execut": [0, 5, 6, 7, 8], "each": [0, 3, 4], "task": 0, "The": [0, 3, 4, 5], "registr": 0, "done": 0, "custom": [0, 4], "script": 0, "These": 0, "under": 0, "secur": [0, 2, 8, 9], "context": [0, 8, 9], "right": [0, 3, 4], "do": [0, 2], "so": 0, "rather": 0, "than": 0, "pass": [0, 4], "credenti": [0, 3, 9], "your": [0, 5], "contributor": [0, 4, 5, 6, 7, 8], "role": [0, 3, 5, 6, 9], "run": [0, 2, 3, 5], "identitynam": 0, "ckazadmanagedident": 0, "previou": [0, 5], "step": [0, 1, 2, 3, 5, 6, 7, 8], "msgraphdcrequest": 0, "msgraphtoken": 0, "msgraphaccesstoken": 0, "onc": 0, "regist": [0, 3], "must": 0, "readwrit": [0, 3, 7, 9], "allow": [0, 3], "call": [0, 3], "read": [0, 3, 4, 5, 9], "updat": 0, "secret": [0, 3], "delet": 0, "servic": [0, 3, 6, 7, 9], "princip": [0, 6, 7, 9], "without": [0, 3], "approleassign": 0, "ani": [0, 3], "includ": 0, "delegatedpermissiongr": 0, "revok": 0, "deleg": 0, "full": 0, "set": [0, 3, 4], "profil": 0, "properti": 0, "membership": 0, "report": [0, 2], "organ": [0, 2, 3, 4], "refer": [0, 7, 8], "doc": [0, 4], "en": [0, 4], "4": [0, 6, 7], "ckazadapppermiss": [0, 7], "spobjectid": [0, 7], "principalid": 0, "resourcenam": [0, 7], "permissiontyp": [0, 7], "azuredeploi": 0, "json": [0, 4, 6, 7, 8], "root": 0, "folder": 0, "you": [0, 4, 5], "can": [0, 1, 3, 4, 5], "One": [0, 3], "click": [0, 5], "identityid": 0, "assignapproletous": 0, "domain": 0, "file": 0, "paramet": [0, 6, 7, 8], "also": [0, 3], "below": 0, "provid": [0, 3], "valu": [0, 4, 5], "section": [0, 1, 2, 5], "portal": [0, 5], "back": [0, 2], "see": 0, "everyth": 0, "being": 0, "exampl": [0, 3, 4, 5], "one": [0, 2, 3], "artifact": 0, "inspect": 0, "log": 0, "what": [0, 4], "shown": 0, "final": [0, 3], "when": [0, 3, 4], "Then": 0, "abl": 0, "explor": [0, 1, 3], "associ": [0, 3], "let": 0, "action": [0, 3, 4, 9], "next": 0, "test": [0, 7, 8], "look": 0, "behind": 0, "That": [0, 5], "cover": [1, 2, 3], "cloud": [1, 4], "katana": [1, 3], "accomplish": 1, "resourc": [1, 2, 4, 5], "manag": [1, 4], "arm": 1, "templat": [1, 3], "devop": 1, "ci": 1, "cd": 1, "pipelin": 1, "instal": [1, 2, 4], "cli": 1, "invok": [1, 3, 5], "webrequest": [1, 5], "uri": [1, 4, 5], "aka": 1, "ms": [1, 8, 9], "installazurecliwindow": 1, "outfil": 1, "azurecli": 1, "msi": 1, "start": [1, 2, 5], "msiexec": 1, "ex": 1, "wait": [1, 3, 7, 8], "argumentlist": 1, "i": [1, 7, 9], "quiet": 1, "rm": 1, "unlock": 2, "comput": 2, "assess": 2, "tool": [2, 3], "develop": 2, "from": [2, 3, 4, 5, 6, 7, 8, 9], "autom": [2, 4], "demand": 2, "multi": [2, 3], "hybrid": [2, 3], "environ": [2, 3], "event": [2, 3], "driven": [2, 3], "built": [2, 3], "top": 2, "azur": [2, 4], "expedit": 2, "research": [2, 3], "valid": 2, "websit": 2, "jupyt": [2, 3], "book": [1, 2], "major": [2, 3], "guid": [2, 4], "demo": 2, "design": [2, 4], "principl": 2, "specif": [2, 3, 8, 9], "area": 2, "depth": [2, 5], "against": [2, 4], "issu": 2, "track": 2, "enhanc": 2, "request": [2, 3], "bug": 2, "item": [2, 5], "discuss": 2, "have": [2, 3, 5], "commun": 2, "talk": 2, "idea": 2, "share": [2, 3], "gener": 2, "question": 2, "feedback": 2, "our": [2, 5], "space": 2, "partner": 2, "threat": [2, 4, 6, 7, 8, 9], "otr": 2, "meet": [2, 3], "passion": 2, "willing": 2, "collabor": 2, "automat": [1, 2, 3], "invit": 2, "discord": 2, "here": 2, "welcom": 2, "anyon": 2, "improv": 2, "help": 2, "anoth": [2, 3], "format": 3, "document": [1, 3, 4], "coverag": 3, "solut": 3, "reli": 3, "platform": [3, 4, 5, 6, 7, 8], "paa": 3, "concept": 3, "simplifi": 3, "scalabl": 3, "worri": 3, "about": 3, "deploi": 3, "maintain": 3, "underli": 3, "infrastructur": 3, "abstract": 3, "oper": 3, "system": [3, 4, 5], "layer": 3, "code": 3, "through": 3, "pai": 3, "per": 3, "bill": 3, "scale": 3, "trigger": 3, "invoc": 3, "repres": [3, 4], "block": 3, "With": 3, "could": 3, "simpli": 3, "send": 3, "inform": [3, 4], "underneath": 3, "current": 3, "written": 3, "powershel": [3, 4, 5, 6, 7, 8], "subject": 3, "chang": 3, "categor": 3, "mitr": 3, "att": [3, 4], "ck": [3, 4], "framework": 3, "everi": 3, "aggreg": 3, "metadata": [3, 5], "titl": 3, "descript": [3, 4, 5, 9], "map": [3, 4], "expect": 3, "input": [3, 5], "output": 3, "even": 3, "precondit": 3, "make": [3, 4], "sure": [3, 4], "permiss": [1, 3, 4, 9], "befor": [3, 4], "programmat": 3, "project": [1, 3, 4, 5], "handl": 3, "ensur": 3, "reliabl": 3, "across": 3, "numer": 3, "extens": [3, 4], "durabl": 3, "scenario": 5, "where": [3, 4], "depend": 3, "good": 3, "defin": [3, 4], "path": [3, 5], "enforc": 3, "best": 3, "practic": 3, "microsoft": [3, 4, 5, 7, 9], "k": 3, "its": [3, 5], "which": 3, "user": [3, 4, 6, 7, 8, 9], "connect": 3, "oauth": 3, "In": [3, 5], "condit": 3, "polici": 3, "factor": 3, "singl": 3, "sso": 3, "implement": 3, "assign": 3, "restrict": 3, "select": 3, "who": 3, "furthermor": 3, "advantag": 3, "remov": 3, "provis": 3, "rotat": 3, "therefor": 3, "graph": [3, 4, 5, 7, 8, 9], "For": 3, "want": [3, 5], "add": [3, 7, 9], "would": 3, "grant": [1, 3, 4, 5, 9], "least": 3, "most": 3, "privileg": [3, 4], "ownedbi": 3, "write": 3, "veri": 3, "power": 3, "flexibl": 3, "doe": 3, "matter": 3, "how": 3, "librari": 3, "msal": [3, 6, 7, 8], "ps": 3, "python": 3, "sourc": 3, "notebook": 3, "creat": [1, 3, 4, 9], "repetit": 3, "show": 3, "experi": 3, "onli": [3, 4], "premis": 3, "relai": 3, "agent": 3, "expos": [3, 5], "public": [3, 4], "sit": 3, "middl": 3, "between": 3, "hcm": 3, "up": 3, "configur": 3, "out": 3, "over": 3, "port": 3, "443": 3, "local": 3, "tl": 3, "1": [3, 4, 5, 6, 7, 8], "2": [3, 6, 7, 8], "signatur": 3, "sa": 3, "kei": [3, 4, 5], "describ": 4, "cours": 4, "compos": 4, "seri": 4, "achiev": 4, "goal": 4, "string": [4, 6, 7, 8], "creationd": [4, 5, 6, 7, 8], "modificationd": [4, 5, 6, 7, 8], "mitreattack": [4, 5, 6, 7, 8], "variabl": 4, "ye": 4, "uniqu": 4, "identifi": 4, "f0b032ec": 4, "192b": 4, "4193": 4, "b8a1": 4, "7ba38bced104": 4, "golden": 4, "saml": 4, "No": 4, "creation": [4, 6, 7, 8], "date": [4, 6, 7, 8], "etc": 4, "either": 4, "dure": 4, "deploy": 4, "list": [4, 6], "pair": 4, "arrai": [4, 7], "varkei": 4, "varvalu": 4, "dictionari": [4, 5], "atom": [4, 5], "wa": 4, "yyyi": 4, "mm": 4, "dd": 4, "2021": [4, 5, 7, 9], "08": 4, "05": [4, 5, 6, 7, 9], "modifi": 4, "09": 4, "aw": 4, "window": 4, "actor": [4, 6, 7, 8, 9], "export": 4, "fs": 4, "token": [4, 9], "certif": 4, "imperson": 4, "exfiltr": 4, "sensit": 4, "peopl": 4, "contribut": 4, "roberto": [4, 5, 6, 7, 8, 9], "rodriguez": [4, 5, 6, 7, 8, 9], "jose": 4, "tactic": [4, 5, 6, 7, 8], "techniqu": [4, 5, 6, 7, 8], "t1552": 4, "004": 4, "ta0006": 4, "access": [4, 5, 9], "permissionstyp": [4, 5], "type": [4, 5, 6, 7, 8], "number": [4, 5, 6, 7, 8], "int": 4, "executor": [4, 5, 6, 7, 8], "defaultvalu": [4, 6, 7, 8], "snumber": 4, "might": 4, "supportingfileuri": 4, "scriptmodul": [4, 5, 6, 7, 8], "scriptfil": 4, "perform": 4, "assum": 4, "againt": 4, "windowshybridwork": 4, "endpoint": [4, 6, 7, 8], "download": 4, "version": [4, 5, 6, 7, 8], "scripturi": 4, "bool": 4, "import": [4, 6, 7, 8], "3": [4, 5, 6, 7, 8], "aadintadfscertif": 4, "usual": 4, "librai": 4, "alreadi": 4, "wai": [4, 5], "default": 4, "xyz": 4, "deploymentscript": 4, "tab": 4, "syntax": 4, "virtual": 4, "machin": 4, "www": 4, "org": 4, "site": 4, "pr": 4, "18": 4, "0944": 4, "11": [4, 5, 7, 9], "philosophi": 4, "pdf": 4, "enterpris": 4, "tenantid": 5, "funcnam": 5, "clientappid": 5, "whether": 5, "campaign": [5, 9], "object": [5, 7, 9], "simureq": 5, "schema": 3, "d782c5cf": 5, "153c": 5, "4588": 5, "b153": 5, "dc54e35afa7f": 5, "get": [5, 9], "compromis": [], "ckazaddirectoryrol": [5, 6], "come": 5, "sever": 5, "directli": 5, "repositori": 5, "raw": 5, "githubusercont": 5, "main": 5, "discoveri": 9, "azure_get_aad_directoryroles_msgraph": [], "yml": [], "tostr": 5, "save": 5, "fullnam": 5, "cktsimul": 5, "yamlstr": [], "cloudkatanaappid": 5, "while": 5, "prompt": 5, "first": 5, "api": [5, 6, 7, 8], "brows": 5, "group": [1, 5, 6, 9], "instanceid": 5, "203c649f": 5, "5771": 5, "431f": 5, "b15e": 5, "7b1411a4d001": 5, "createdtim": 5, "2022": [5, 6, 7, 8, 9], "06": 5, "02t02": 5, "58": 5, "19z": 5, "lastupdatedtim": 5, "23z": 5, "runtimestatu": 5, "complet": 5, "contain": 5, "collect": 5, "It": 5, "cyb3rward0g": [5, 6, 7, 8, 9], "01": [5, 6, 7, 9], "modif": [6, 7, 8], "ta0003": [6, 7, 8], "t1098": [6, 7, 8], "001": [6, 7, 8], "disov": [6, 9], "publicclientappl": [6, 7, 8], "time": [6, 7, 8], "function_app_url": [6, 7, 8], "function_app_nam": [6, 7, 8], "azurewebsit": [6, 7, 8], "net": [6, 7, 8], "tenant_id": [6, 7, 8], "public_client_app_id": [6, 7, 8], "katana_client_app_id": [6, 7, 8], "server_app_id_uri": [6, 7, 8], "scope": [6, 7, 8], "user_imperson": [6, 7, 8], "microsoftonlin": [6, 7, 8], "result": [6, 7, 8], "acquire_token_interact": [6, 7, 8], "bearer_token": [6, 7, 8], "data": [6, 7, 8], "attackscenario": [5, 6, 7, 8], "7d918ee0": 6, "6928": 6, "48c5": 6, "8cf9": 6, "5dfb88abc7c4": 6, "modul": [6, 7, 8], "ckazadus": 6, "selectfield": 6, "displaynam": 6, "ckazadappl": 6, "ckazadserviceprincip": 6, "ckazadgroup": 6, "file_nam": [6, 7, 8], "http_header": [6, 7, 8], "bearer": [6, 7, 8], "accept": [6, 7, 8], "content": [6, 7, 8], "header": [6, 7, 8], "stream": [6, 7, 8], "fals": [6, 7, 8], "sleep": [6, 7, 8], "30": [6, 7, 8], "query_statu": [6, 7, 8], "statusquerygeturi": [6, 7, 8], "query_result": [6, 7, 8], "rolemanag": [7, 9], "e": [7, 9], "global": [7, 9], "administr": [7, 9], "7dde2208": 7, "d4eb": 7, "480e": 7, "afa1": 7, "bad0ab7e861b": 7, "addpasswordtoaadapp": [5, 7, 8], "ckazadapppassword": [7, 8], "appobjectid": [7, 8], "120": 7, "getaccesstokenon": 7, "dependson": [7, 8], "client_credenti": [7, 8], "appsecret": [7, 8], "secrettext": [7, 8], "grantrolemgmtpermiss": 7, "getaccesstokentwo": 7, "addserviceprincipaltogarol": 7, "ckazaddirectoryrolememb": 7, "directoryroletemplateid": 7, "directoryobjectid": 7, "04": [8, 9], "28": [8, 9], "81b67a16": 8, "5218": 8, "41e6": 8, "8c6d": 8, "1fc6a10b757a": 8, "getaccesstoken": 8, "getmailboxmessag": 8, "ckmailboxmessag": 8, "userprincipalnam": 8, "admin": [5, 9], "promot": [5, 9], "light": 9, "password": 9, "mail": 9, "manual": 1, "clone": 1, "ident": 1, "mi": 1, "tbd": 1, "order": 5, "t1580": 5, "ta0007": 5, "convertto": 5, "aadlightdiscoveri": 5, "scenariodeploi": 5, "jsonstr": 5}, "objects": {}, "objtypes": {}, "objnames": {}, "titleterms": {"azur": [0, 1, 3, 5, 6, 7, 8, 9], "resourc": [0, 3], "manag": [0, 3], "templat": [0, 4], "authent": [0, 3, 5], "clone": 0, "project": 0, "import": [0, 5], "cloud": [0, 2, 3, 5], "katana": [0, 2, 5], "tool": [0, 5], "powershel": 0, "modul": [0, 4, 5], "defin": [0, 5], "variabl": [0, 5], "get": [0, 2, 6, 7, 8], "access": [0, 3, 6, 7, 8], "token": [0, 6, 7, 8], "api": [0, 3], "request": [0, 5, 6, 7, 8], "devic": 0, "code": 0, "retriev": 0, "creat": 0, "group": 0, "user": 0, "assign": 0, "ident": [0, 3], "microsoft": 0, "graph": 0, "grant": [0, 7], "permiss": [0, 5, 7], "deploi": [0, 1], "arm": 0, "cli": 0, "button": 0, "monitor": [0, 5], "deploy": 0, "requir": 1, "about": 2, "doc": 2, "structur": 2, "contribut": 2, "learn": 2, "more": 2, "involv": 2, "design": 3, "principl": 3, "A": 3, "serverless": 3, "execut": [3, 4], "model": 3, "comput": 3, "demand": 3, "web": 3, "yaml": [], "base": 3, "attack": [3, 4], "definit": [], "orchestr": [3, 5, 6, 7, 8], "state": 3, "secur": 3, "author": [3, 4], "integr": 3, "granular": 3, "control": 3, "program": 3, "languag": 3, "agnost": 3, "client": 3, "prem": 3, "simul": [3, 5], "scenario": [3, 4], "schema": 4, "campaign": [4, 6, 7, 8], "format": 4, "metadata": [4, 6, 7, 8], "mitr": 4, "context": 4, "step": 4, "script": 4, "mode": 4, "file": [4, 5], "paramet": 4, "properti": 4, "refer": 4, "set": [5, 6, 7, 8], "local": 5, "string": 5, "remot": 5, "accept": 5, "One": 5, "time": 5, "function": [1, 5, 6, 7, 8], "log": 5, "activ": 5, "inspect": 5, "output": [5, 6, 7, 8], "respons": 5, "ad": [6, 8], "light": 6, "discoveri": 6, "descript": [6, 7, 8], "oauth": [6, 7, 8], "load": [6, 7, 8], "send": [6, 7, 8], "http": [6, 7, 8], "explor": [6, 7, 8], "admin": 7, "promot": 7, "via": 7, "directori": 7, "role": 7, "add": 8, "new": 8, "password": 8, "credenti": 8, "applic": 8, "read": 8, "mail": 8, "att": 9, "ck": 9, "navig": 9, "view": 9, "tabl": 9, "app": 1, "json": [3, 5]}, "envversion": {"sphinx.domains.c": 2, "sphinx.domains.changeset": 1, "sphinx.domains.citation": 1, "sphinx.domains.cpp": 6, "sphinx.domains.index": 1, "sphinx.domains.javascript": 2, "sphinx.domains.math": 2, "sphinx.domains.python": 3, "sphinx.domains.rst": 2, "sphinx.domains.std": 2, "sphinx.ext.intersphinx": 1, "sphinx": 56}})