
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Design Principles</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://cloud-katana.com/learn/principles/intro.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Simulation Schema" href="../schema.html" />
    <link rel="prev" title="Azure Resource Manager Template" href="../../deploy/azure/arm.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/Logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../deploy/azure/intro.html">
   Deploy to Azure
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../deploy/azure/arm.html">
     Azure Resource Manager Template
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Internals
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Design Principles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../schema.html">
   Simulation Schema
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../simulation.html">
   Request Simulations
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Targeted Notebooks
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../simulate/windows/intro.html">
   Windows
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../simulate/windows/discovery/intro.html">
     discovery
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/windows/discovery/list_windows_firewall_rules_via_netsh.html">
       List Windows Firewall Rules via Netsh
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/windows/discovery/list_open_egress_ports_via_.net_tcpclient_class.html">
       List Open Egress Ports via .NET TcpClient Class
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../simulate/azure/intro.html">
   Azure
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../simulate/azure/collection/intro.html">
     collection
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/collection/get_my_mailbox_messages.html">
       Get My Mailbox Messages
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/collection/get_user_mailbox_messages.html">
       Get User Mailbox Messages
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../simulate/azure/discovery/intro.html">
     discovery
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/discovery/get_azure_ad_application_metadata.html">
       Get Azure AD Application Metadata
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/discovery/get_owners_of_an_azure_ad_application_or_service_principal.html">
       Get Owners of an Azure AD Application or Service Principal
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/discovery/get_azure_ad_directory_roles.html">
       Get Azure AD Directory Roles
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/discovery/get_azure_ad_groups.html">
       Get Azure AD Groups
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/discovery/get_members_of_an_azure_ad_group.html">
       Get members of an Azure AD Group
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/discovery/get_azure_ad_oauth_permission_grants.html">
       Get Azure AD OAuth Permission Grants
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/discovery/get_azure_ad_resources_and_graph_them.html">
       Get Azure AD Resources and Graph Them
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/discovery/get_azure_ad_service_principal_metadata.html">
       Get Azure AD Service Principal Metadata
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/discovery/get_azure_ad_users.html">
       Get Azure AD Users
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../simulate/azure/persistence/intro.html">
     persistence
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/persistence/add_new_owner_to_azure_ad_application.html">
       Add New Owner to Azure AD Application
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/persistence/add_password_to_azure_ad_application.html">
       Add Password to Azure AD Application
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/persistence/add_new_member_to_azure_ad_directory_role.html">
       Add New Member to Azure AD Directory Role
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/persistence/add_new_member_to_azure_ad_group.html">
       Add New member to Azure AD Group
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/persistence/add_new_owner_to_azure_ad_service_principal.html">
       Add New Owner to Azure AD Service Principal
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/persistence/add_password_to_azure_ad_service_principal.html">
       Add Password to Azure AD Service Principal
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/persistence/add_new_domain_to_azure_ad_tenant.html">
       Add New Domain to Azure AD Tenant
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/persistence/grant_permission_to_azure_ad_application.html">
       Grant Permission to Azure AD Application
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/persistence/create_new_azure_ad_application.html">
       Create New Azure AD Application
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/persistence/create_new_azure_ad_service_principal_for_application.html">
       Create New Azure AD Service Principal for Application
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../simulate/azure/persistence/update_azure_ad_application_required_resource_access.html">
       Update Azure AD Application Required Resource Access
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/Azure/Cloud-Katana"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/Azure/Cloud-Katana/issues/new?title=Issue%20on%20page%20%2Flearn/principles/intro.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/Azure/Cloud-Katana/edit/main/docs/learn/principles/intro.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/learn/principles/intro.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-serverless-execution-model">
   A “serverless” execution model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compute-on-demand-as-a-web-api">
   Compute on-demand as a Web API
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#yaml-based-attack-definitions">
   YAML based attack definitions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#orchestrated-stateful-execution">
   Orchestrated stateful execution
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#secure-authentication-and-authorization">
   Secure Authentication and Authorization
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#authentication">
     Authentication
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#authorization">
     Authorization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#managed-identities-integration">
   Managed Identities Integration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#granular-access-control-to-azure-resources">
   Granular access control to Azure Resources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#programming-language-agnostic-clients">
   Programming language agnostic clients
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cloud-and-on-prem-simulations">
   Cloud and on-prem simulations
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Design Principles</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-serverless-execution-model">
   A “serverless” execution model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compute-on-demand-as-a-web-api">
   Compute on-demand as a Web API
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#yaml-based-attack-definitions">
   YAML based attack definitions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#orchestrated-stateful-execution">
   Orchestrated stateful execution
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#secure-authentication-and-authorization">
   Secure Authentication and Authorization
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#authentication">
     Authentication
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#authorization">
     Authorization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#managed-identities-integration">
   Managed Identities Integration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#granular-access-control-to-azure-resources">
   Granular access control to Azure Resources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#programming-language-agnostic-clients">
   Programming language agnostic clients
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cloud-and-on-prem-simulations">
   Cloud and on-prem simulations
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="design-principles">
<h1>Design Principles<a class="headerlink" href="#design-principles" title="Permalink to this headline">#</a></h1>
<p><img alt="" src="../../_images/KatanaDesign.png" /></p>
<ul class="simple">
<li><p>A serverless execution model</p></li>
<li><p>Compute on-demand as a web API</p></li>
<li><p>YAML based format to document attacker actions</p></li>
<li><p>Orchestrated stateful execution</p></li>
<li><p>Secure authentication and authorization</p></li>
<li><p>Managed identity integration</p></li>
<li><p>Granular access control</p></li>
<li><p>Programming language agnostic clients</p></li>
<li><p>Cloud and on-prem coverage</p></li>
</ul>
<div class="section" id="a-serverless-execution-model">
<h2>A “serverless” execution model<a class="headerlink" href="#a-serverless-execution-model" title="Permalink to this headline">#</a></h2>
<p>Cloud Katana is a cloud-native solution that relies on platform as a service (PaaS) concepts to provide a simplified and scalable event-driven solution without worrying about deploying and maintaining the underlying infrastructure used to execute simulations.</p>
<p>To meet this need, Cloud Katana uses <a class="reference external" href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview">Azure Functions</a> to abstract the operating system layer from the code through a pay-per-execution billing model that automatically scales based on trigger invocations.</p>
<p><img alt="" src="../../_images/ServerlessExecutionModel.png" /></p>
</div>
<div class="section" id="compute-on-demand-as-a-web-api">
<h2>Compute on-demand as a Web API<a class="headerlink" href="#compute-on-demand-as-a-web-api" title="Permalink to this headline">#</a></h2>
<p>Simulation steps are represented as blocks of code called “functions” and invoked via HTTP requests through a built-in serverless web API.</p>
<p>With this feature one could simply send an HTTP request with information about the specific simulation and wait for the infrastructure underneath to process the request. Currently, all functions are written in PowerShell (subject to change) and categorized following the MITRE ATT&amp;CK framework.</p>
<p><img alt="" src="../../_images/ComputeOnDemandWebAPI.png" /></p>
</div>
<div class="section" id="yaml-based-attack-definitions">
<h2>YAML based attack definitions<a class="headerlink" href="#yaml-based-attack-definitions" title="Permalink to this headline">#</a></h2>
<p>Every attack simulation is documented in a YAML based format to aggregate metadata such as title, description, ATT&amp;CK mappings, expected input and output and even preconditions to make sure we have the right permissions before running a simulation step. This facilitates the processing of every documented action programmatically and the automatic setup of a few other resources.</p>
<p><img alt="" src="../../_images/YAMLBasedAttackDefinitions.png" /></p>
</div>
<div class="section" id="orchestrated-stateful-execution">
<h2>Orchestrated stateful execution<a class="headerlink" href="#orchestrated-stateful-execution" title="Permalink to this headline">#</a></h2>
<p>The project is also designed to handle state and ensure reliability across numerous attack simulations by using an extension of Azure functions named <a class="reference external" href="https://docs.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-overview?tabs=powershell">durable functions</a>. This feature allows the orchestration and execution of scenarios where actions could depend on the state and output of other simulation steps. This is good to define specific attack paths as code.</p>
<p><img alt="" src="../../_images/OrchestratedStatefulExecution.png" /></p>
</div>
<div class="section" id="secure-authentication-and-authorization">
<h2>Secure Authentication and Authorization<a class="headerlink" href="#secure-authentication-and-authorization" title="Permalink to this headline">#</a></h2>
<p>Cloud Katana also enforces authentication and authorization best practices to secure the application.</p>
<div class="section" id="authentication">
<h3>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">#</a></h3>
<p>The project uses the <a class="reference external" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-overview">Microsoft Identity Platform</a> (a.k.a Azure AD) as its identity provider to authenticate clients. This feature requires a registered Azure AD application which allows users to connect to the Azure Function app using OAuth authentication.</p>
<p>In addition, using an identity provider enables the following features:</p>
<ul class="simple">
<li><p>Conditional access policies</p></li>
<li><p>The use of <a class="reference external" href="https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-mfa-howitworks">multi-factor authentication</a></p></li>
<li><p>Single sign-on (SSO)</p></li>
</ul>
<p><img alt="" src="../../_images/DeviceAuthGrantFlow.png" /></p>
</div>
<div class="section" id="authorization">
<h3>Authorization<a class="headerlink" href="#authorization" title="Permalink to this headline">#</a></h3>
<p>Besides enforcing users to authenticate before executing simulations, the project also implements “Application Role Assignments” to restrict access to selected users. This allows organizations to select who can use the project in their environments.</p>
</div>
</div>
<div class="section" id="managed-identities-integration">
<h2>Managed Identities Integration<a class="headerlink" href="#managed-identities-integration" title="Permalink to this headline">#</a></h2>
<p>Furthermore, when executing simulations in Azure, Cloud Katana uses a user-assigned managed identity to access and interact with other Azure AD-protected resources. One of the advantages of managed identities is that it removes the need to provision or rotate any secrets.</p>
<p><img alt="" src="../../_images/UserAssignedManagedIdentity.png" /></p>
</div>
<div class="section" id="granular-access-control-to-azure-resources">
<h2>Granular access control to Azure Resources<a class="headerlink" href="#granular-access-control-to-azure-resources" title="Permalink to this headline">#</a></h2>
<p>In addition, access to Azure resources is defined by the permissions assigned to the managed identity. We currently cover Azure based scenarios. Therefore, we use permissions associated with <a class="reference external" href="https://docs.microsoft.com/en-us/graph/permissions-reference">each major set of Microsoft Graph APIs</a> to control access to specific Azure resources.</p>
<p>For example, if we wanted to use Cloud Katana to add credentials to an application, we would need to grant the <a class="reference external" href="https://docs.microsoft.com/en-us/graph/api/application-addpassword?view=graph-rest-1.0&amp;tabs=http#permissions">following permissions</a> (From least to most privileged) to the managed identity:</p>
<ul class="simple">
<li><p>Application.ReadWrite.OwnedBy</p></li>
<li><p>Application.Read.Write.All</p></li>
</ul>
<p><img alt="" src="../../_images/GranularAccessControl.png" /></p>
</div>
<div class="section" id="programming-language-agnostic-clients">
<h2>Programming language agnostic clients<a class="headerlink" href="#programming-language-agnostic-clients" title="Permalink to this headline">#</a></h2>
<p>Another feature that makes Cloud Katana a very powerful tool is the flexibility to use any programming language to request simulations. If the client used to interact with Cloud Katana can handle the Azure AD authentication process, it does not matter how the simulation is requested.</p>
<p><img alt="" src="../../_images/ProgrammingLanguageAgnosticClient.png" /></p>
<p>Microsoft Authentication libraries are available via PowerShell as <a class="reference external" href="https://github.com/AzureAD/MSAL.PS">MSAL.PS</a> and Python as <a class="reference external" href="https://pypi.org/project/msal/">MSAL</a> . We could also use other open-source projects such as <a class="reference external" href="https://jupyter.org/">Jupyter Notebooks</a> to create repetitive templates to show the execution of simulations and share the process with other security researchers.</p>
<p><img alt="" src="../../_images/JupyterNotebookSimulations.png" /></p>
</div>
<div class="section" id="cloud-and-on-prem-simulations">
<h2>Cloud and on-prem simulations<a class="headerlink" href="#cloud-and-on-prem-simulations" title="Permalink to this headline">#</a></h2>
<p>Finally, we are currently experimenting with <a class="reference external" href="https://docs.microsoft.com/en-us/azure/app-service/app-service-hybrid-connections">Azure App Service Hybrid Connections</a> to not only run simulations in the cloud, but also on-premises. Hybrid Connections use a <a class="reference external" href="https://docs.microsoft.com/en-us/azure/azure-relay/relay-what-is-it">relay agent</a> to securely expose services that run on-premises to the public cloud.  The relay agent sits in the middle between the on-prem server and the Cloud Katana Azure Function app.</p>
<p>A relay agent ( <a class="reference external" href="https://docs.microsoft.com/en-us/azure/app-service/app-service-hybrid-connections#hybrid-connection-manager">Hybrid Connection Manager (HCM)</a> ) is set up on the on-prem server and configured to call out to the Azure Relay over port 443. The Cloud Katana function app then connects to the Azure Relay to interact with the on-prem server and execute simulations locally. The connection uses TLS 1.2 for security and shared access signature (SAS) keys for authentication and authorization.</p>
<p><img alt="" src="../../_images/OnPremSimulations.png" /></p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "Azure/Cloud-Katana",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./learn\principles"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../../deploy/azure/arm.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Azure Resource Manager Template</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../schema.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Simulation Schema</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Microsoft Corporation<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>